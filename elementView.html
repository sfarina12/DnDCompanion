<html>
    <head>
        <title> For The Dark Soul </title>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="css/elementView.css">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    </head>
    <body>
        <a href="index.html"><div id="logo"> <img src="img/DarkMark.png"> </div> </a>

        <h2>Categories</h2>
        <div id="container_categories">
            <div class="dummy_element_category"></div>
        </div>

        <h2 id="wpn">Weapons</h2>
        <div id="categories_weapons">
            <div class="dummy_element_weapon"></div>
            
            <!--<div class="element_weapon c_selected">
                <img class="image_weapon" src="img/holder.jpg">
                <table class="w_name"><tr><td>moai</td></tr></table>
                <div class="expanded">
                    <div class="ext_bor"><img src="img/corner.png"></div>
                    i'm a text
                </div>
            </div>!-->

        </div>
    </body>

    <script src="DarkSoulsWeapons.js"></script>
    <script>
        isFirst=true;
        var lastSelected;

        function addCategoryUI(name)
        {
            $("#container_categories").append("<div class='element_category'><table class='c_name'><tr><td>"+name+"</td></tr></table></div>")

            if(isFirst)
            {
                isFirst=false;
                selectFirst()
            }
        }

        function selectFirst()
        {
            $(".element_category").addClass("c_selected")

            cat_name=$(".element_category").find("td").html()

            $("#categories_weapons").empty()
            $("#categories_weapons").append("<div class='dummy_element_weapon'></div>");

            data.forEach(item => {
                if(item.category==cat_name) { addWeaponUI(item.image,item.name) }     
            });

            lastSelected=$(".element_category")
        }

        function addWeaponUI(img,name)
        {
            $("#categories_weapons").append("<div class='element_weapon'> <img class='image_weapon' alt='the link is broken' onerror=this.src='img/ater.png' src="+img+"> <table class='w_name'><tr><td>"+name+"</td></tr></table> </div>")
        }

        $("document").ready(function() {

            categories=[
                { "name":"Daggers", "start":0, "end":5},
                { "name":"Straight Swords", "start":6, "end":18},
                { "name":"Greatswords", "start":19, "end":31},
                { "name":"Ultra Greatswords", "start":32, "end":36},
                { "name":"Curved Swords", "start":37, "end":43},
                { "name":"Katanas", "start":44, "end":47},
                { "name":"Curved Greatswords", "start":48, "end":50},
                { "name":"Piercing Swords", "start":51, "end":55},
                { "name":"Axes", "start":56, "end":61},
                { "name":"Great Axes", "start":62, "end":66},
                { "name":"Hammers", "start":67, "end":75},
                { "name":"Great Hammers", "start":76, "end":80},
                { "name":"Fist & Claws", "start":81, "end":85},
                { "name":"Spears", "start":86, "end":95},
                { "name":"Halberds", "start":96, "end":104},
                { "name":"Whips", "start":105, "end":107},
                { "name":"Bows", "start":108, "end":112},
                { "name":"Greatbows", "start":113, "end":114},
                { "name":"Crossbows", "start":115, "end":118},
                { "name":"Flames", "start":119, "end":120},
                { "name":"Catalysts", "start":121, "end":131},
                { "name":"Talismans", "start":132, "end":140}
            ]

            var weap_Cont=0;
            var act_caty=0;
            data.forEach(dataItem=>{
                urlImage="https://darksouls.wiki.fextralife.com/file/Dark-Souls/"
                weapName=dataItem.name.replace(/ /g,"_").toLowerCase();    
                urlImage+=weapName+".png"

                dataItem.image=urlImage;

                start=categories[act_caty].start
                end=categories[act_caty].end
                
                if(weap_Cont < start || weap_Cont > end) { act_caty++ }    
                
                dataItem.category=categories[act_caty].name
            
                weap_Cont++    
            });
                    
            categories.forEach(item=>{
                addCategoryUI(item.name)
            });

            
            $(".element_category").click(function(){
                $(lastSelected).removeClass("c_selected")
                $(this).addClass("c_selected")

                cat_name=$(this).find("td").html()
                
                $("#categories_weapons").empty()
                $("#categories_weapons").append("<div class='dummy_element_weapon'></div>");

                data.forEach(item => {
                    console.log(item)
                    if(item.category==cat_name)
                    {
                        addWeaponUI(item.image,item.name)
                    }
                });

                lastSelected=this
            });            
        });
    </script>
</html>