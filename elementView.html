<html>
    <head>
        <title> For The Dark Soul </title>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="css/elementView.css">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    </head>
    <body>
        <a href="index.html"><div id="logo"> <img src="img/DarkMark.png"> </div> </a>

        <h2>Categories</h2>
        <div id="container_categories">
            <div class="dummy_element_category"></div>
        </div>

        <h2 id="wpn">Weapons</h2>
        <div id="categories_weapons">
            <div class="dummy_element_weapon"></div>
            
            <!--<div class="element_weapon">
                <div style="display: flex;">
                    <img class="image_weapon" src="img/holder.jpg">
                    <div class="mainStats">
                        <div class="stat">attack type<div style="float: right;">ciao</div></div>
                        <div class="stat">requirements<div style="float: right;">ciao</div></div>
                        <div class="stat">scale<div style="float: right;">ciao</div></div>
                        <div class="stat">weight<div style="float: right;">ciao</div></div>
                    </div>
                </div>

                <table class="w_name"><tr><td>moai</td></tr></table>
                
                <div class="expanded closed">
                    <div class="statContainer">damage
                        <div class="statCategories">
                            <div style="background-color: #949494;">physic<br>58</div>
                            <div style="background-color: #955b9b;">magic<br>56</div>
                            <div style="background-color: #ee8229;">fire<br>56</div>
                            <div style="background-color: #d3c018;">lighting<br>56</div>
                            <div style="background-color: #3c3ed8;">bonus<br>56</div>
                        </div>
                    </div>
                    <div class="statContainer">defence
                        <div class="statCategories">
                            <div style="background-color: #949494;">physic<br>56</div>
                            <div style="background-color: #955b9b;">magic<br>56</div>
                            <div style="background-color: #ee8229;">fire<br>56</div>
                            <div style="background-color: #d3c018;">lighting<br>56</div>
                            <div style="background-color: #3c3ed8;">bonus<br>56</div>
                        </div>
                    </div>
                    <div class="statContainer">effects
                        <div class="statCategories">
                            <div style="background-color: #811981;">poison<br>56</div>
                            <div style="background-color: #a83131;">bleed<br>56</div>
                            <div style="background-color: #a7a7a7;">divine<br>56</div>
                            <div style="background-color: #303030;">occult<br>56</div>
                        </div>
                    </div>
                </div>
            </div>!-->
        </div>
    </body>

    <script src="DarkSoulsWeapons.js"></script>
    <script>
        isFirst=true;
        var lastSelected;
        var lastSelectedWeap;

        function addCategoryUI(name)
        {
            $("#container_categories").append("<div class='element_category'><table class='c_name'><tr><td>"+name+"</td></tr></table></div>")

            if(isFirst)
            {
                isFirst=false;
                selectFirst()
            }
        }

        function selectFirst()
        {
            $(".element_category").addClass("c_selected")

            cat_name=$(".element_category").find("td").html()

            $("#categories_weapons").empty()
            $("#categories_weapons").append("<div class='dummy_element_weapon'></div>");

            data.forEach(item => {
                if(item.category==cat_name) { addWeaponUI(item) }     
            });

            lastSelected=$(".element_category")
            lastSelectedWeap=null
        }

        function addWeaponUI(item)
        {
            console.log(item);
            $("#categories_weapons").append(
                "<div class='element_weapon'>"+
                    "<div style='display: flex;'>"+
                        "<img class='image_weapon' alt='the link is broken' onerror=this.src='img/ater.png' src="+item.image+">"+
                        "<div class='mainStats'>"+
                            "<div class='stat closed'>attack type<div style='float: right;'>"+item.attackTypes+"</div></div>"+
                            "<div class='stat closed'>requirements<div style='float: right;'>"+item.req+"</div></div>"+
                            "<div class='stat closed'>scale<div style='float: right;'>"+item.scale+"</div></div>"+
                            "<div class='stat closed'>weight<div style='float: right;'>"+item.weight+"</div></div>"+
                        "</div>"+
                    "</div>"+
                    "<table class='w_name'><tr><td>"+item.name+"</td></tr></table>"+
                    "<div class='expanded closed'>"+
                        "<div class='statContainer'>damage"+
                            "<div class='statCategories'>"+
                                "<div style='background-color: #949494;'>physic<br>"+(item.atk.physical===undefined?"-":item.atk.physical)+"</div>"+
                                "<div style='background-color: #955b9b;'>magic<br>"+(item.atk.magic===undefined?"-":item.atk.magic)+"</div>"+
                                "<div style='background-color: #ee8229;'>fire<br>"+(item.atk.fire===undefined?"-":item.atk.fire)+"</div>"+
                                "<div style='background-color: #d3c018;'>lighting<br>"+(item.atk.lightning===undefined?"-":item.atk.lightning)+"</div>"+
                                "<div style='background-color: #3c3ed8;'>bonus<br>"+(item.atk.bonus===undefined?"-":item.atk.bonus)+"</div>"+
                            "</div>"+
                        "</div>"+
                        "<div class='statContainer'>defence"+
                            "<div class='statCategories'>"+
                                "<div style='background-color: #949494;'>physic<br>"+(item.def.physical===undefined?"-":item.def.physical)+"</div>"+
                                "<div style='background-color: #955b9b;'>magic<br>"+(item.def.magic===undefined?"-":item.def.magic)+"</div>"+
                                "<div style='background-color: #ee8229;'>fire<br>"+(item.def.fire===undefined?"-":item.def.fire)+"</div>"+
                                "<div style='background-color: #d3c018;'>lighting<br>"+(item.def.lightning===undefined?"-":item.def.lightning)+"</div>"+
                                "<div style='background-color: #3c3ed8;'>bonus<br>"+(item.def.bonus===undefined?"-":item.def.bonus)+"</div>"+
                            "</div>"+
                        "</div>"+
                        "<div class='statContainer'>effects"+
                            "<div class='statCategories'>"+
                                "<div style='background-color: #811981;'>poison<br>"+(item.effects.poison===null?"-":item.effects.poison)+"</div>"+
                                "<div style='background-color: #a83131;'>bleed<br>"+(item.effects.bleed===null?"-":item.effects.bleed)+"</div>"+
                                "<div style='background-color: #a7a7a7;'>divine<br>"+(item.effects.divine===null?"-":item.effects.divine)+"</div>"+
                                "<div style='background-color: #303030;'>occult<br>"+(item.effects.occult===null?"-":item.effects.occult)+"</div>"+
                            "</div>"+
                        "</div>"+
                    "</div>"+
                "</div>"
            );
        }

        $("document").ready(function() {

            categories=[
                { "name":"Daggers", "start":0, "end":5},
                { "name":"Straight Swords", "start":6, "end":18},
                { "name":"Greatswords", "start":19, "end":31},
                { "name":"Ultra Greatswords", "start":32, "end":36},
                { "name":"Curved Swords", "start":37, "end":43},
                { "name":"Katanas", "start":44, "end":47},
                { "name":"Curved Greatswords", "start":48, "end":50},
                { "name":"Piercing Swords", "start":51, "end":55},
                { "name":"Axes", "start":56, "end":61},
                { "name":"Great Axes", "start":62, "end":66},
                { "name":"Hammers", "start":67, "end":75},
                { "name":"Great Hammers", "start":76, "end":80},
                { "name":"Fist & Claws", "start":81, "end":85},
                { "name":"Spears", "start":86, "end":95},
                { "name":"Halberds", "start":96, "end":104},
                { "name":"Whips", "start":105, "end":107},
                { "name":"Bows", "start":108, "end":112},
                { "name":"Greatbows", "start":113, "end":114},
                { "name":"Crossbows", "start":115, "end":118},
                { "name":"Flames", "start":119, "end":120},
                { "name":"Catalysts", "start":121, "end":131},
                { "name":"Talismans", "start":132, "end":140}
            ]

            var weap_Cont=0;
            var act_caty=0;
            data.forEach(dataItem=>{
                urlImage="https://darksouls.wiki.fextralife.com/file/Dark-Souls/"
                weapName=dataItem.name.replace(/ /g,"_").toLowerCase();    
                urlImage+=weapName+".png"

                dataItem.image=urlImage;

                start=categories[act_caty].start
                end=categories[act_caty].end
                
                if(weap_Cont < start || weap_Cont > end) { act_caty++ }    
                
                dataItem.category=categories[act_caty].name
            
                weap_Cont++    
            });
  

            categories.forEach(item=>{
                addCategoryUI(item.name)
            });

            $(".element_category").click(function(){
                $(lastSelected).removeClass("c_selected")
                $(this).addClass("c_selected")

                cat_name=$(this).find("td").html()
                
                $("#categories_weapons").empty()
                $("#categories_weapons").append("<div class='dummy_element_weapon'></div>");

                data.forEach(item => {
                    
                    if(item.category==cat_name)
                    {
                        addWeaponUI(item)
                    }
                });

                lastSelected=this
            });  
            
            $("body").on("click",".element_weapon",function(){
                if(this!=lastSelectedWeap && lastSelectedWeap!=null)
                {
                    $(lastSelectedWeap).removeClass("c_selected_w")
                    $(lastSelectedWeap).find(".expanded").addClass("closed")
                    $(lastSelectedWeap).find(".mainStats .stat").addClass("closed")
                }

                $(this).addClass("c_selected_w")
                $(this).find("div").removeClass("closed")
                lastSelectedWeap=this;                
            });
        });
    </script>
</html>